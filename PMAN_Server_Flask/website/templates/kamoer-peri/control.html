{% extends "layout.html" %} {% block head%}
<style type="text/css" media="screen">
.pump-control-card{
	box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
	padding:0.5em;
	display:flex;
	flex-direction: column;
	gap:0.5em;
	border-radius:0.5em;
}
.pump-control-container{
	display: grid;
	grid-template-columns: 1fr 1fr 1fr;
	gap: 1em;
}
span.addr{
	font-weight: bold;
}
button {
	border:solid 1px black;
	color:black;
	border-radius:2px;
}
</style>
{% endblock %} {% block content%}
<h2>Kamoer Peri Control</h2>
<div class="pump-control-container">
{% for addr in addrs %}
  <div class="pump-control-card">
	  <span class="addr">Address: {{addr}}</span>
      <label for="direction">Direction</label>
      <select id="direction-{{addr}}" name="direction-{{addr}}">
	      <option value=1>clockwise</option>
	      <option value=0>counterclockwise</option>
      </select>
      <label for="rpm">RPM</label>
      <input type="text" value="400" id="rpm-{{addr}}" name="rpm-{{addr}}"/>
      <button type="button" onclick="start_pump({{addr}})">Start</button>
      <button type="button" onclick="stop_pump({{addr}})">Stop</button>
  </div>
{% endfor %}
</div>

{% endblock %} {% block scripts %}
<script>
const base_url = '/pman/kamoer-peri'
async function start_pump(addr){
	let rpm = document.getElementById(`rpm-${addr}`).value
	let direction = document.getElementById(`direction-${addr}`).value
	let response = await fetchPOST(`${base_url}/start`, {args:[rpm,direction,addr]})
	display(response)
}
async function stop_pump(addr){
	let response = await fetchPOST(`${base_url}/stop`,{args:[addr]})
	display(response)
}
{% for addr in addrs %}
enforceCharset("rpm-{{addr}}","0123456789")
enforceRange("rpm-{{addr}}",0,400)
{% endfor %}
</script>
{% endblock%}
